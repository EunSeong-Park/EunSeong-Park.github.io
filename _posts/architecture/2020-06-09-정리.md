---
title: "Summary & Exercises"
tags: Computer-Architecture
toc: true
---

# Intro
컴퓨터 구조(computer architecture)에서 필요한 공식이나 정보, 또는 연습문제, 그리고 해결 아이디어를 정리해보았다.


# Summary & Exercise
## Amdahl's Law
암달의 법칙은 다음과 같이 나타내어진다.

$T_{\text{improved}} = \frac{T_{\text{affected}}}{\text{(improvement factor)}} + T_{\text{unaffected}}$

개선은 병렬화를 포함하며, 병렬화에 따른 속도 향상도 암달의 법칙에 의해 다음과 같이 나타낼 수 있다.

$\text{Speed up} = {1 \over (1-F_{\text{parallelizable}}) + \frac{F_{\text{parallelizable}}}{\text{parallel}}}$

### Exercise 1
110초 걸리는 어떤 프로그램에서 100초는 곱셈에 의해 소요된다. 이 프로그램을 다섯 배 빠르게 실행되게 하려면, 어느 정도의 곱셈 속도 개선을 수행해야 하는가?

#### Answer
$T_{\text{improved}} = \frac{T_{\text{affected}}}{\text{(improvement factor)}} + T_{\text{unaffected}}$ = $\frac{100}{n} + 10 = 110 * \frac{1}{5} = 22$, $n = 8.33$. 즉, 8.33배 개선되어야 한다.

## Performance

- $\text{Performance} = {1 \over \text{Execution time}}$
- $\text{Total CPI} = \sum (CPI_i * {\text{# instruction} \over \text{# total instruction}})$
- $\text{CPU Time} = \text{(# instruction)} * CPI * \text{(cucle time)}$
- $MIPS = {\text{clock rate} \over \text{CPI * 10^6}}$

### Exercise 2
동일한 명령어 집합을 가진 3개의 프로세서 P1, P2, P3은 다음과 같은 스펙을 가지고 있다.

Processor | Clock rate | CPI
---|---|---
P1 | 3 GHz | 1.5
P2 | 2.5 GHz | 1.0
P3 | 4 GHz | 2.2

초당 명령어 수로 프로세서의 성능을 비교하고(a), 각 프로세서가 어떤 프로그램을 수행하는데 10초가 걸렸다고 가정하고 각 프로세서의 사이클 수와 명령어를 구하자(b).

#### Answer
초당 명령어 수는 $\frac{\text{# of instruction}}{\text{CPU time}}$이고, 이를 변형하면 $\frac{\text{cycles}}{\text{CPI}} * \frac{1}{\text{CPU time}}$ $=\frac{\text{Clock rate}}{\text{CPI}}$다. 즉, P1은 2G, P2는 2.5G, P3은 1.82G로, P2의 성능이 가장 좋다.

또, 이에 따라, 10초가 걸리는 프로그램을 수행한다고 하면, P1은 20G, P2는 25G, P3은 18.2G의 명령어가 수행되고, 각각의 CPI에 따라, 30G, 25G, 40G개의 사이클이 각각 돌아간다. 이는 클럭 속도(clock rate)의 정의를 생각하면 당연하다.

### Exercise 3
동일한 ISA를 가진 두 프로세서, P1, P2가 있다. 명령어는 A, B, C, D, 네 종류가 있으며 각 프로세서에 대한 클럭 속도와 CPI는 다음과 같다.

Processor | Clock rate | CPI of A | CPI of B | CPI of C | CPI of D
---|---|---|---|---|---
P1 | 2.5 GHz | 1 | 2 | 3 | 3
P2 | 3 GHz | 2 | 2 | 2 | 2

그리고 $10^6$개의 명령하는 프로그램이 있는데, 이는 10%의 A, 20%의 B, 50%의 C, 20%의 D를 포함한다. 어떤 프로세서가 이 프로그램을 빠르게 구동시킬 수 있을까? 이를 알기 위해, 각 프로세서의 전체 CPI과 프로그램의 실행을 위해 필요한 클럭 사이클 수를 구해보자.

#### Answer
전체 CPI를 먼저 구해보자. P1은 $(0.1 * 1) + (0.2 * 2) + (0.5 * 3) + (0.2 * 3) = 2.6$이고, P2는 $(0.1 * 2) + (0.2 * 2) + (0.5 * 2) + (0.2 * 2) = 2.0$이다. 총 $10^6$개의 명령어를 실행하므로, 돌아가는 사이클은 각각 $2.6M$, $2.0M$으로 볼 수 있고, 클럭 속도를 고려하면 각각 $\frac{2.6M}{2.5G} = 1.04 K^{-1}$, $\frac{2.0M}{3G} = 0.67 K^{-1}$의 시간이 걸린다. 즉, P2가 더 빠르다.

## Power Issues
$P = P_{\text{static}} + P_{\text{dynamic}}$으로 볼 수 있다.

- $P_{\text{dynamic}} = \frac{1}{2}C V_{DD}^2 f_{CLK}$
- $P_{\text{static}} = I_{leak} V_{DD}$

### Exercise 4
전압이 1.25V, 클럭 속도가 3.6 GHz인 프로세서 P1는 평균 10W의 정(static)전력을, 평균 90W의 동(dynamic)전력을 소비하며, P2는 전압이 0.9V, 클럭 속도가 3.4 GHz이며, 평균 30W의 정전력, 평균 40W의 동전력을 소비한다고 가정한다.

각 프로세서의 용량성 부하(C)와 정전력이 차지하는 비율을 구하고, 정전력을 유지한 채 전체 소모 전력을 10% 감소시키려면 전압을 각각 얼마나 낮춰야하는지 확인해보자.

#### Answer
평균 소비 동전력 $P$에 대하여, $P = CV^2f$이므로, $C = \frac{P}{V^2f}$다. 따라서, P1은 $\frac{90 A * V}{(1.25 V^2)(3.6 * 10^9 s^{-1})} = \frac{90 C * s^{-1} * V}{(1.25 V^2)(3.6 * 10^9 s^{-1})} = 1.6 * 10^{-8} \frac{C}{V} = 16nF$고, 같은 방식으로 P2는 약 $14.52nF$다.

정전력의 비는 간단하게 구할 수 있다. 각각 $\frac{10W}{10W+90W} = 0.1$, $\frac{30W}{30W+40W} = 0.43$이다.

총 전력 소모는 각각 100W, 70W였다. 고로 목표는 각각 90W, 63W이며, 전압의 변화는 정전력과 동전력 모두에 영향을 끼친다는 점을 기억하자. 우리는 정전력 공식으로부터 누설 전류($I_{leak}$)를 구할 수 있고, 위에서 용량성 부하(C)를 이미 구했다. 이를 바탕으로 이차식을 세워 적절히 계산해주면 된다. 계산은 귀찮아서 생략ㅎ

## Cache Memory
가장 간단한 직접 사상 캐시를 기준으로 생각한다. 주소의 구조는 아래와 같은 규칙을 따른다.

- 블록 크기가 $2^m$바이트라면, 최하위 $m$비트는 바이트 오프셋이 된다.
- 블록 개수가 $2^n$개라면, 그 다음 하위 $n$ 비트는 캐시의 인덱스가 된다.
- 나머지 비트들은 블록 일치 여부를 확인하기 위한 태그가 된다.

평균 메모리 접근 시간, AMAT은 다음과 같이 정의된다.

$AMAT = \text{(Hit Time)} + \text{(Miss Rate)} * \text{(Miss Penalty)}$

메모리 접근 시간이 주어졌을 때, 미스 패널티는 $(\text{(I-cache miss rate)}$ $ + \text{(D-cache miss rate)} $ $ * \text{(Rate of memory access instruction)})$ $ * \text{(Memory access time)}$이다. 단, 먼저 메모리 접근 시간이 아닌, 메모리 접근 사이클을 구해서, 이를 미스 패널티를 구한다. 사이클은 중간에 끊기거나 다음 명령어로 넘어갈 수 없기 때문에, 실제로 주어진 시간보다 더 많이 필요할 수 있다.

다단계 캐시에서의 AMAT은 다음과 같이 구한다.

$AMAT =$ $\text{(L1 Hit Time)} $ $+ \text{(L1 Miss Rate)} * (\text{(L2 Hit Time)} +$ $ (\text{(L2 Miss Rate)} * \text{(Miss Penalty)}))$